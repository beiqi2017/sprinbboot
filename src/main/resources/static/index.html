<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>登录</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
<!-- Bootstrap -->
<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
 <script src="./plugin/bootbox.min.js"></script>
<style>
	body{font-family:"微软雅黑";}
	.wrap1{color:#fff;position:absolute; top:0; right:0; bottom:0; left:0; margin:auto }/*把整个屏幕真正撑开--而且能自己实现居中*/
	.main_content{background-color:rgba(66, 123, 169, 0.75); margin-left:auto; margin-right:auto; text-align:left; float:none; border-radius:8px;}
	.font16{font-size:18px;}
	.col-xs-10{margin-top:20px;}
	@media (min-width:200px){.pd-xs-20{padding:20px;}}
	@media (min-width:768px){.pd-sm-50{padding:50px;}}

</style>

</head>

<script type="text/javascript"> 

   if(navigator.userAgent.match(/mobile/i)) { 
	  $("#code").css("padding","6px 6px")
    }
    function changeImg() { 
        var imgSrc = $("#imgObj"); 
        var src = imgSrc.attr("src"); 
        imgSrc.attr("src", chgUrl(src)); 
    } 
    
    //时间戳     
    //为了使每次生成图片不一致，即不让浏览器读缓存，所以需要加上时间戳     
    function chgUrl(url) { 
        var timestamp = (new Date()).valueOf(); 
        url = url.substring(0,9); 
        if ((url.indexOf("&") >= 0)) { 
            url = url + "×tamp=" + timestamp; 
        } else { 
            url = url + "?timestamp=" + timestamp; 
        } 
        return url; 
    } 
    
 
	function loginSubmit() {
		if (validateLoginForm()) {
			var login= new Object();
			login.username=$("#username").val().trim();
			login.password = $("#password").val().trim();
			login.code = $("#code").val().trim();
		    $.ajax({
		        type: "POST",
		        url: "./loginUser",
		        dataType: "json",
		        contentType:"application/json",
		        data:JSON.stringify(login),
		        async : false,
		        success: function(data){
					if (data.success) {
						 window.location.href="./page/home.html";
					} else {
						changeImg();
						bootbox.alert(data.msg)
					}
		           }
		     });
			
			
			
		}
	}

	function validateLoginForm() {
		var username = $("#username").val();
		if (!username) {
			bootbox.alert("登录名不能为空");
			return false;
		}
		var password = $("#password").val();
		if (!password) {
			bootbox.alert("密码不能为空");
			return false;
		}
		var code = $("#code").val();
		if (!code) {
			bootbox.alert("验证码不能为空");
			return false;
		}
		return true;
	}
</script> 
<body>
    
    <div class="container wrap1" style="height:350px;">
            
            <div class="col-sm-8 col-md-4 center-auto pd-sm-45 pd-xs-20 main_content">
                <p class="text-center font16">用户登录</p>
                <form>
                    <div class="input-group col-xs-10 col-sm-offset-1 col-xs-offset-1">
                      <div class="input-group-addon"><span class="glyphicon glyphicon-user"></span></div>
                      <input type="text" class="form-control" id="username" placeholder="请输入用户名">
                    </div>
                    <div class="input-group col-xs-10 col-sm-offset-1 col-xs-offset-1">
                      <div class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></div>
                      <input type="password" class="form-control" id="password" placeholder="请输入密码">
                    </div>
                    <div class="input-group col-xs-10 col-sm-offset-1 col-xs-offset-1">
                      <div class="input-group-addon"><span class="glyphicon glyphicon-picture"></span></div>
                      <input type="text" class="form-control" id="code" placeholder="请输入验证码">
                      <div class="input-group-addon" style="padding:0px"><img id="imgObj" src="./code.do" height="31px" onclick="changeImg()" title="点击刷新" style="vertical-align: middle;"/></div>
                    </div>
                    <div class="input-group col-xs-10 col-sm-offset-1 col-xs-offset-1"></div>
                    <div class="control-group" style="text-align:center;">
                      <button type="button" class="btn btn-success" style="margin-right:10px;" onclick="loginSubmit()">登 录</button>
                      <button type="button" class="btn btn-info" style="margin-left:10px;">重 置</button>
                    </div>
               </form>
        </div><!--row end-->
    </div><!--container end-->
     
</body>
</html>
